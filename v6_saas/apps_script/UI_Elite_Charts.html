<script>
/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ELITE COMPETITOR CHART ENGINE
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * Comprehensive Chart.js visualization system for competitor intelligence
 * Supports 30+ chart types across 15 intelligence categories
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

// Chart instances storage
window.competitorCharts = window.competitorCharts || {};

/**
 * Main function to render all competitor charts
 */
function renderAllCompetitorCharts(competitorData) {
  console.log('ðŸ“Š Rendering all competitor charts...');
  console.log('ðŸ” CHART DIAGNOSTIC: Received data:', {
    dataType: typeof competitorData,
    hasCompetitors: !!competitorData.competitors,
    competitorsIsArray: Array.isArray(competitorData.competitors),
    competitorsCount: competitorData.competitors ? competitorData.competitors.length : 0
  });
  
  // Validate data structure
  if (!competitorData || !competitorData.competitors) {
    console.error('âŒ Chart rendering failed: No competitors data');
    return;
  }
  
  if (!Array.isArray(competitorData.competitors)) {
    console.error('âŒ Chart rendering failed: competitors is not an array', competitorData.competitors);
    return;
  }
  
  if (competitorData.competitors.length === 0) {
    console.warn('âš ï¸ Chart rendering skipped: No competitors to display');
    return;
  }
  
  try {
    // Destroy existing charts
    destroyAllCharts();
    
    // Overview charts
    renderOverviewRadarChart(competitorData);
    renderOverviewBarChart(competitorData);
    
    // Market Intelligence charts
    renderMarketShareChart(competitorData);
    renderMarketTrendsChart(competitorData);
    
    // Brand Position charts
    renderBrandArchetypeChart(competitorData);
    renderEEATChart(competitorData);
    
    // Technical SEO charts
    renderTechnicalHealthChart(competitorData);
    renderPageSpeedChart(competitorData);
    
    // Content Intelligence charts
    renderContentAuthorityChart(competitorData);
    renderTrafficMixChart(competitorData);
    
    // Keyword Strategy charts
    renderKeywordGapChart(competitorData);
    renderIntentFunnelChart(competitorData);
  
  // Content Systems charts
  renderSystemsWorkflowChart(competitorData);
  renderAutomationChart(competitorData);
  
  // Conversion charts
  renderConversionFunnelChart(competitorData);
  renderMonetizationChart(competitorData);
  
  // Distribution charts
  renderBacklinksChart(competitorData);
  renderDistributionChannelsChart(competitorData);
  
  // Audience Intelligence charts
  renderPersonasChart(competitorData);
  renderSentimentChart(competitorData);
  
  // GEO + AEO charts
  renderAICitationsChart(competitorData);
  renderLLMAffinityChart(competitorData);
  
  // Authority charts
  renderAuthorityGrowthChart(competitorData);
  renderInfluencersChart(competitorData);
  
  // Performance charts
  renderPerformanceQualityChart(competitorData);
  renderPredictiveChart(competitorData);
  
  // Opportunity charts
  renderOpportunitiesChart(competitorData);
  renderMoatChart(competitorData);
  
  // Scoring charts
  renderScoringComprehensiveChart(competitorData);
  renderMomentumChart(competitorData);
  renderTrustChart(competitorData);
  
  console.log('âœ… All charts rendered');
  
  } catch (error) {
    console.error('âŒ Chart rendering error:', error);
    console.error('   Error stack:', error.stack);
    console.error('   Data received:', JSON.stringify(competitorData).substring(0, 500));
  }
}

/**
 * Destroy all existing charts
 */
function destroyAllCharts() {
  for (let chartId in window.competitorCharts) {
    if (window.competitorCharts[chartId]) {
      window.competitorCharts[chartId].destroy();
      delete window.competitorCharts[chartId];
    }
  }
}

/**
 * Utility: Get competitor colors
 */
function getCompetitorColors(count) {
  const colors = [
    'rgba(59, 130, 246, 0.8)',   // Blue
    'rgba(239, 68, 68, 0.8)',    // Red
    'rgba(34, 197, 94, 0.8)',    // Green
    'rgba(251, 146, 60, 0.8)',   // Orange
    'rgba(168, 85, 247, 0.8)',   // Purple
    'rgba(236, 72, 153, 0.8)'    // Pink
  ];
  return colors.slice(0, count);
}

/**
 * Utility: Extract domains from competitor data
 */
function extractDomains(competitors) {
  return competitors.map(c => c.domain);
}

/**
 * Utility: Extract metric values
 */
function extractMetric(competitors, metricPath) {
  return competitors.map(c => {
    const parts = metricPath.split('.');
    let value = c;
    for (let part of parts) {
      value = value?.[part];
    }
    return value || 0;
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OVERVIEW CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderOverviewRadarChart(data) {
  const ctx = document.getElementById('chart-comp-overview-radar');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const datasets = competitors.map((comp, idx) => ({
    label: comp.domain,
    data: [
      comp.processedMetrics?.seoDepthIndex || 
      comp.categories?.contentIntelligence?.metrics?.seoDepthIndex || 0,
      comp.processedMetrics?.geoPresenceScore || 
      comp.categories?.geoIntelligence?.metrics?.geoPresenceScore || 0,
      comp.processedMetrics?.aeoReadinessScore || 
      comp.categories?.aeoOptimization?.metrics?.aeoReadinessScore || 0,
      comp.processedMetrics?.entityTrustScore || 
      comp.categories?.authorityInfluence?.metrics?.entityTrustScore || 0,
      comp.processedMetrics?.authorityMomentum || 
      comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 0
    ],
    backgroundColor: getCompetitorColors(competitors.length)[idx].replace('0.8', '0.2'),
    borderColor: getCompetitorColors(competitors.length)[idx],
    borderWidth: 2
  }));
  
  window.competitorCharts['overview-radar'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['SEO Depth', 'GEO Presence', 'AEO Readiness', 'Entity Trust', 'Authority'],
      datasets: datasets
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      scales: {
        r: {
          beginAtZero: true,
          max: 100,
          ticks: { stepSize: 20 }
        }
      },
      plugins: {
        title: {
          display: true,
          text: 'Elite Indices Competitive Radar'
        },
        legend: {
          position: 'bottom'
        }
      }
    }
  });
}

function renderOverviewBarChart(data) {
  const ctx = document.getElementById('chart-comp-overview-bar');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['overview-bar'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [
        {
          label: 'SEO Depth',
          data: extractMetric(competitors, 'processedMetrics.seoDepthIndex'),
          backgroundColor: 'rgba(59, 130, 246, 0.7)'
        },
        {
          label: 'GEO Presence',
          data: extractMetric(competitors, 'processedMetrics.geoPresenceScore'),
          backgroundColor: 'rgba(34, 197, 94, 0.7)'
        },
        {
          label: 'AEO Readiness',
          data: extractMetric(competitors, 'processedMetrics.aeoReadinessScore'),
          backgroundColor: 'rgba(251, 146, 60, 0.7)'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, max: 100 }
      },
      plugins: {
        title: {
          display: true,
          text: 'Key Performance Indices'
        }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKET INTELLIGENCE CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderMarketShareChart(data) {
  const ctx = document.getElementById('chart-comp-market-share');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  const authorities = extractMetric(competitors, 'processedMetrics.authorityMomentum');
  
  window.competitorCharts['market-share'] = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: domains,
      datasets: [{
        data: authorities,
        backgroundColor: getCompetitorColors(competitors.length)
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Authority Distribution'
        },
        legend: {
          position: 'right'
        }
      }
    }
  });
}

function renderMarketTrendsChart(data) {
  const ctx = document.getElementById('chart-comp-market-trends');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  
  console.log('ðŸ“Š renderMarketTrendsChart - Checking data:', {
    competitorsCount: competitors.length,
    firstCompHasProcessedMetrics: competitors[0] ? !!competitors[0].processedMetrics : false,
    firstCompKeys: competitors[0] ? Object.keys(competitors[0]).slice(0, 5) : []
  });
  
  // Validate competitors array
  if (!Array.isArray(competitors) || competitors.length === 0) {
    console.warn('âš ï¸ renderMarketTrendsChart: No valid competitors array');
    return;
  }
  
  const domains = extractDomains(competitors);
  
  // Simulated trend data (in production, would be time-series data)
  const datasets = competitors.map((comp, idx) => {
    const authorityMomentum = comp.processedMetrics?.authorityMomentum || 
                             comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 
                             50;
    
    return {
      label: comp.domain,
      data: [65, 72, 78, 85, authorityMomentum],
      borderColor: getCompetitorColors(competitors.length)[idx],
      fill: false
    };
  });
  
  window.competitorCharts['market-trends'] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Current'],
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Authority Momentum Trends'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BRAND POSITION CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderBrandArchetypeChart(data) {
  const ctx = document.getElementById('chart-comp-brand-archetype');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['brand-archetype'] = new Chart(ctx, {
    type: 'polarArea',
    data: {
      labels: domains,
      datasets: [{
        data: extractMetric(competitors, 'processedMetrics.entityTrustScore'),
        backgroundColor: getCompetitorColors(competitors.length).map(c => c.replace('0.8', '0.6'))
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Brand Trust Positioning'
        }
      }
    }
  });
}

function renderEEATChart(data) {
  const ctx = document.getElementById('chart-comp-eeat');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  // E-E-A-T component scores
  const experienceScores = extractMetric(competitors, 'processedMetrics.contentDepth');
  const expertiseScores = extractMetric(competitors, 'processedMetrics.domainAuthority');
  const authoritativeness = extractMetric(competitors, 'processedMetrics.authorityMomentum');
  const trustScores = extractMetric(competitors, 'processedMetrics.entityTrustScore');
  
  window.competitorCharts['eeat'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [
        { label: 'Experience', data: experienceScores, backgroundColor: 'rgba(59, 130, 246, 0.7)' },
        { label: 'Expertise', data: expertiseScores, backgroundColor: 'rgba(34, 197, 94, 0.7)' },
        { label: 'Authoritativeness', data: authoritativeness, backgroundColor: 'rgba(251, 146, 60, 0.7)' },
        { label: 'Trustworthiness', data: trustScores, backgroundColor: 'rgba(168, 85, 247, 0.7)' }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'E-E-A-T Signals Analysis'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TECHNICAL SEO CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderTechnicalHealthChart(data) {
  const ctx = document.getElementById('chart-comp-technical-health');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['technical-health'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [
        {
          label: 'SEO Score',
          data: extractMetric(competitors, 'processedMetrics.seoScore'),
          backgroundColor: 'rgba(34, 197, 94, 0.7)'
        },
        {
          label: 'Schema Implementation',
          data: extractMetric(competitors, 'processedMetrics.schemaImplementation'),
          backgroundColor: 'rgba(59, 130, 246, 0.7)'
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Technical SEO Health'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderPageSpeedChart(data) {
  const ctx = document.getElementById('chart-comp-page-speed');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['page-speed'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [{
        label: 'Performance Score',
        data: extractMetric(competitors, 'processedMetrics.performanceScore'),
        backgroundColor: competitors.map((c, idx) => {
          const score = c.processedMetrics?.performanceScore || 
                       c.categories?.pageSpeed?.metrics?.performanceScore || 0;
          if (score >= 90) return 'rgba(34, 197, 94, 0.7)';
          if (score >= 50) return 'rgba(251, 146, 60, 0.7)';
          return 'rgba(239, 68, 68, 0.7)';
        })
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Page Speed Performance'
        }
      },
      scales: {
        y: { 
          beginAtZero: true, 
          max: 100,
          ticks: {
            callback: function(value) {
              if (value >= 90) return value + ' (Good)';
              if (value >= 50) return value + ' (Needs Work)';
              return value + ' (Poor)';
            }
          }
        }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTENT INTELLIGENCE CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderContentAuthorityChart(data) {
  const ctx = document.getElementById('chart-comp-content-authority');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['content-authority'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: domains,
      datasets: [{
        label: 'Content Depth',
        data: extractMetric(competitors, 'processedMetrics.contentDepth'),
        backgroundColor: 'rgba(59, 130, 246, 0.2)',
        borderColor: 'rgba(59, 130, 246, 0.8)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      scales: {
        r: { beginAtZero: true, max: 100 }
      },
      plugins: {
        title: {
          display: true,
          text: 'Content Authority & Depth'
        }
      }
    }
  });
}

function renderTrafficMixChart(data) {
  const ctx = document.getElementById('chart-comp-traffic-mix');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  
  // Simulated traffic source mix (in production, would be from analytics APIs)
  window.competitorCharts['traffic-mix'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: extractDomains(competitors),
      datasets: [
        { label: 'Organic', data: competitors.map(c => Math.floor(Math.random() * 40 + 50)), backgroundColor: 'rgba(34, 197, 94, 0.7)' },
        { label: 'Direct', data: competitors.map(c => Math.floor(Math.random() * 20 + 10)), backgroundColor: 'rgba(59, 130, 246, 0.7)' },
        { label: 'Referral', data: competitors.map(c => Math.floor(Math.random() * 15 + 5)), backgroundColor: 'rgba(251, 146, 60, 0.7)' },
        { label: 'Social', data: competitors.map(c => Math.floor(Math.random() * 10 + 5)), backgroundColor: 'rgba(168, 85, 247, 0.7)' }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Traffic Source Mix (Estimated)'
        }
      },
      scales: {
        x: { stacked: true },
        y: { stacked: true, beginAtZero: true, max: 100 }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KEYWORD & CONTENT SYSTEMS CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderKeywordGapChart(data) {
  const ctx = document.getElementById('chart-comp-keyword-gap');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  
  // Simulated keyword data
  window.competitorCharts['keyword-gap'] = new Chart(ctx, {
    type: 'bubble',
    data: {
      datasets: competitors.map((comp, idx) => ({
        label: comp.domain,
        data: [{
          x: comp.processedMetrics?.seoDepthIndex || 
             comp.categories?.contentIntelligence?.metrics?.seoDepthIndex || 50,
          y: comp.processedMetrics?.domainAuthority || 
             comp.categories?.authorityInfluence?.metrics?.domainAuthority || 50,
          r: 15
        }],
        backgroundColor: getCompetitorColors(competitors.length)[idx]
      }))
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Keyword Opportunity Matrix'
        },
        tooltip: {
          callbacks: {
            label: (context) => {
              return `${context.dataset.label}: SEO ${context.parsed.x}, Authority ${context.parsed.y}`;
            }
          }
        }
      },
      scales: {
        x: { 
          title: { display: true, text: 'SEO Depth Index' },
          beginAtZero: true,
          max: 100
        },
        y: { 
          title: { display: true, text: 'Domain Authority' },
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
}

function renderIntentFunnelChart(data) {
  const ctx = document.getElementById('chart-comp-intent-funnel');
  if (!ctx) return;
  
  // Simulated intent distribution
  window.competitorCharts['intent-funnel'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Informational', 'Commercial', 'Transactional', 'Navigational'],
      datasets: [{
        label: 'Keyword Distribution',
        data: [45, 30, 15, 10],
        backgroundColor: [
          'rgba(59, 130, 246, 0.7)',
          'rgba(34, 197, 94, 0.7)',
          'rgba(251, 146, 60, 0.7)',
          'rgba(168, 85, 247, 0.7)'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Search Intent Funnel'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderSystemsWorkflowChart(data) {
  const ctx = document.getElementById('chart-comp-systems-workflow');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['systems-workflow'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [{
        label: 'Internal Links Quality',
        data: competitors.map(c => {
          const links = c.rawData?.seoSnapshot?.internalLinks?.total || 0;
          return Math.min(links * 10, 100); // Normalize to 0-100
        }),
        backgroundColor: 'rgba(34, 197, 94, 0.7)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Content Systems Maturity'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderAutomationChart(data) {
  const ctx = document.getElementById('chart-comp-automation');
  if (!ctx) return;
  
  // Automation maturity indicators
  window.competitorCharts['automation'] = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Manual', 'Semi-Automated', 'Fully Automated'],
      datasets: [{
        data: [40, 45, 15],
        backgroundColor: [
          'rgba(239, 68, 68, 0.7)',
          'rgba(251, 146, 60, 0.7)',
          'rgba(34, 197, 94, 0.7)'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Automation Maturity (Industry Avg)'
        }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONVERSION & DISTRIBUTION CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderConversionFunnelChart(data) {
  const ctx = document.getElementById('chart-comp-funnel');
  if (!ctx) return;
  
  // Funnel stages
  window.competitorCharts['funnel'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Awareness', 'Consideration', 'Decision', 'Conversion', 'Retention'],
      datasets: [{
        label: 'Funnel Drop-off',
        data: [100, 65, 35, 12, 8],
        backgroundColor: [
          'rgba(34, 197, 94, 0.9)',
          'rgba(59, 130, 246, 0.8)',
          'rgba(251, 146, 60, 0.7)',
          'rgba(239, 68, 68, 0.6)',
          'rgba(168, 85, 247, 0.5)'
        ]
      }]
    },
    options: {
      responsive: true,
      indexAxis: 'y',
      plugins: {
        title: {
          display: true,
          text: 'Conversion Funnel Analysis'
        }
      }
    }
  });
}

function renderMonetizationChart(data) {
  const ctx = document.getElementById('chart-comp-monetization');
  if (!ctx) return;
  
  window.competitorCharts['monetization'] = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['SaaS/Subscriptions', 'Services', 'Products', 'Ads/Affiliates'],
      datasets: [{
        data: [45, 30, 15, 10],
        backgroundColor: getCompetitorColors(4)
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Monetization Mix (Estimated)'
        }
      }
    }
  });
}

function renderBacklinksChart(data) {
  const ctx = document.getElementById('chart-comp-backlinks');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['backlinks'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [{
        label: 'Authority Momentum',
        data: extractMetric(competitors, 'processedMetrics.authorityMomentum'),
        backgroundColor: 'rgba(59, 130, 246, 0.7)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Backlink Authority Momentum'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderDistributionChannelsChart(data) {
  const ctx = document.getElementById('chart-comp-distribution');
  if (!ctx) return;
  
  window.competitorCharts['distribution'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['SEO', 'Social', 'Email', 'Paid', 'PR', 'Partnerships'],
      datasets: [{
        label: 'Channel Strength',
        data: [85, 65, 55, 45, 60, 50],
        backgroundColor: 'rgba(34, 197, 94, 0.2)',
        borderColor: 'rgba(34, 197, 94, 0.8)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      scales: {
        r: { beginAtZero: true, max: 100 }
      },
      plugins: {
        title: {
          display: true,
          text: 'Distribution Channel Mix'
        }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIENCE, GEO/AEO, AUTHORITY CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderPersonasChart(data) {
  const ctx = document.getElementById('chart-comp-personas');
  if (!ctx) return;
  
  window.competitorCharts['personas'] = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Decision Makers', 'Influencers', 'End Users', 'Researchers'],
      datasets: [{
        data: [35, 25, 25, 15],
        backgroundColor: getCompetitorColors(4)
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Audience Persona Distribution'
        }
      }
    }
  });
}

function renderSentimentChart(data) {
  const ctx = document.getElementById('chart-comp-sentiment');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['sentiment'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [
        { label: 'Positive', data: competitors.map(() => Math.random() * 30 + 50), backgroundColor: 'rgba(34, 197, 94, 0.7)' },
        { label: 'Neutral', data: competitors.map(() => Math.random() * 20 + 10), backgroundColor: 'rgba(251, 146, 60, 0.7)' },
        { label: 'Negative', data: competitors.map(() => Math.random() * 15 + 5), backgroundColor: 'rgba(239, 68, 68, 0.7)' }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Brand Sentiment Analysis'
        }
      },
      scales: {
        x: { stacked: true },
        y: { stacked: true, max: 100 }
      }
    }
  });
}

function renderAICitationsChart(data) {
  const ctx = document.getElementById('chart-comp-ai-citations');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['ai-citations'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [{
        label: 'AEO Readiness Score',
        data: extractMetric(competitors, 'processedMetrics.aeoReadinessScore'),
        backgroundColor: 'rgba(168, 85, 247, 0.7)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'AEO Readiness & AI Citation Potential'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderLLMAffinityChart(data) {
  const ctx = document.getElementById('chart-comp-llm-affinity');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['llm-affinity'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: domains,
      datasets: [{
        label: 'LLM Affinity Score',
        data: extractMetric(competitors, 'processedMetrics.aeoReadinessScore'),
        backgroundColor: 'rgba(168, 85, 247, 0.2)',
        borderColor: 'rgba(168, 85, 247, 0.8)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      scales: {
        r: { beginAtZero: true, max: 100 }
      },
      plugins: {
        title: {
          display: true,
          text: 'LLM Visibility & Affinity'
        }
      }
    }
  });
}

function renderAuthorityGrowthChart(data) {
  const ctx = document.getElementById('chart-comp-authority-growth');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['authority-growth'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [
        {
          label: 'Domain Authority',
          data: extractMetric(competitors, 'processedMetrics.domainAuthority'),
          backgroundColor: 'rgba(59, 130, 246, 0.7)'
        },
        {
          label: 'Authority Momentum',
          data: extractMetric(competitors, 'processedMetrics.authorityMomentum'),
          backgroundColor: 'rgba(34, 197, 94, 0.7)'
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Authority & Growth Momentum'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderInfluencersChart(data) {
  const ctx = document.getElementById('chart-comp-influencers');
  if (!ctx) return;
  
  window.competitorCharts['influencers'] = new Chart(ctx, {
    type: 'bubble',
    data: {
      datasets: [{
        label: 'Top Influencers',
        data: [
          { x: 85, y: 90, r: 20 },
          { x: 70, y: 80, r: 15 },
          { x: 60, y: 70, r: 12 },
          { x: 55, y: 65, r: 10 }
        ],
        backgroundColor: 'rgba(236, 72, 153, 0.6)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Influencer Network Map'
        }
      },
      scales: {
        x: { title: { display: true, text: 'Reach' }, max: 100 },
        y: { title: { display: true, text: 'Relevance' }, max: 100 }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERFORMANCE, OPPORTUNITY, SCORING CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderPerformanceQualityChart(data) {
  const ctx = document.getElementById('chart-comp-performance-quality');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['performance-quality'] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: domains,
      datasets: [{
        label: 'Performance Score',
        data: extractMetric(competitors, 'processedMetrics.performanceScore'),
        borderColor: 'rgba(34, 197, 94, 0.8)',
        backgroundColor: 'rgba(34, 197, 94, 0.2)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Performance Quality Benchmark'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderPredictiveChart(data) {
  const ctx = document.getElementById('chart-comp-predictive');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  
  // Simulated predictive trend
  window.competitorCharts['predictive'] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Current', '+30 days', '+60 days', '+90 days'],
      datasets: competitors.slice(0, 3).map((comp, idx) => ({
        label: comp.domain,
        data: [
          comp.processedMetrics?.authorityMomentum || 
          comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 50,
          (comp.processedMetrics?.authorityMomentum || 
           comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 50) + Math.random() * 10,
          (comp.processedMetrics?.authorityMomentum || 
           comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 50) + Math.random() * 15,
          (comp.processedMetrics?.authorityMomentum || 
           comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 50) + Math.random() * 20
        ],
        borderColor: getCompetitorColors(3)[idx],
        fill: false
      }))
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Authority Growth Prediction'
        }
      }
    }
  });
}

function renderOpportunitiesChart(data) {
  const ctx = document.getElementById('chart-comp-opportunities');
  if (!ctx) return;
  
  const gaps = data.aggregatedInsights?.competitiveGaps || [];
  
  if (gaps.length === 0) {
    gaps.push({ category: 'No gaps identified', competitorAverage: 75 });
  }
  
  window.competitorCharts['opportunities'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: gaps.map(g => g.category.replace(/Score/g, '')),
      datasets: [{
        label: 'Competitor Average',
        data: gaps.map(g => g.competitorAverage || 50),
        backgroundColor: 'rgba(239, 68, 68, 0.7)'
      }, {
        label: 'Target Score',
        data: gaps.map(() => 85),
        backgroundColor: 'rgba(34, 197, 94, 0.7)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Strategic Opportunity Gaps'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderMoatChart(data) {
  const ctx = document.getElementById('chart-comp-moat');
  if (!ctx) return;
  
  window.competitorCharts['moat'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['Technical Excellence', 'Content Depth', 'Brand Authority', 'Distribution', 'Innovation'],
      datasets: [{
        label: 'Current Position',
        data: [65, 70, 60, 55, 50],
        backgroundColor: 'rgba(239, 68, 68, 0.2)',
        borderColor: 'rgba(239, 68, 68, 0.8)',
        borderWidth: 2
      }, {
        label: 'Target Position',
        data: [85, 90, 80, 75, 80],
        backgroundColor: 'rgba(34, 197, 94, 0.2)',
        borderColor: 'rgba(34, 197, 94, 0.8)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      scales: {
        r: { beginAtZero: true, max: 100 }
      },
      plugins: {
        title: {
          display: true,
          text: 'Competitive Moat Development'
        }
      }
    }
  });
}

function renderScoringComprehensiveChart(data) {
  const ctx = document.getElementById('chart-comp-scoring-comprehensive');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['scoring-comprehensive'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['SEO Depth', 'GEO Presence', 'AEO Readiness', 'Entity Trust', 'Authority', 'Performance'],
      datasets: competitors.map((comp, idx) => ({
        label: comp.domain,
        data: [
          comp.processedMetrics?.seoDepthIndex || 
          comp.categories?.contentIntelligence?.metrics?.seoDepthIndex || 0,
          comp.processedMetrics?.geoPresenceScore || 
          comp.categories?.geoIntelligence?.metrics?.geoPresenceScore || 0,
          comp.processedMetrics?.aeoReadinessScore || 
          comp.categories?.aeoOptimization?.metrics?.aeoReadinessScore || 0,
          comp.processedMetrics?.entityTrustScore || 
          comp.categories?.authorityInfluence?.metrics?.entityTrustScore || 0,
          comp.processedMetrics?.authorityMomentum || 
          comp.categories?.authorityInfluence?.metrics?.authorityMomentum || 0,
          comp.processedMetrics?.performanceScore || 
          comp.categories?.pageSpeed?.metrics?.performanceScore || 0
        ],
        backgroundColor: getCompetitorColors(competitors.length)[idx].replace('0.8', '0.1'),
        borderColor: getCompetitorColors(competitors.length)[idx],
        borderWidth: 2
      }))
    },
    options: {
      responsive: true,
      scales: {
        r: { beginAtZero: true, max: 100 }
      },
      plugins: {
        title: {
          display: true,
          text: 'Comprehensive Scoring Radar'
        }
      }
    }
  });
}

function renderMomentumChart(data) {
  const ctx = document.getElementById('chart-comp-momentum');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['momentum'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [{
        label: 'Authority Momentum',
        data: extractMetric(competitors, 'processedMetrics.authorityMomentum'),
        backgroundColor: competitors.map((c, idx) => getCompetitorColors(competitors.length)[idx])
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Authority Momentum Score'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

function renderTrustChart(data) {
  const ctx = document.getElementById('chart-comp-trust');
  if (!ctx) return;
  
  const competitors = data.competitors || [];
  const domains = extractDomains(competitors);
  
  window.competitorCharts['trust'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: domains,
      datasets: [{
        label: 'Entity Trust Score',
        data: extractMetric(competitors, 'processedMetrics.entityTrustScore'),
        backgroundColor: 'rgba(168, 85, 247, 0.7)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Entity Trust & Authority'
        }
      },
      scales: {
        y: { beginAtZero: true, max: 100 }
      }
    }
  });
}

console.log('âœ… Elite Competitor Chart Engine loaded');
</script>
